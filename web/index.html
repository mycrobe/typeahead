<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Typeahead</title>
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="../bower_components/bootstrap-material-design/css-compiled/ripples.css" rel="stylesheet">
    <link href="../bower_components/bootstrap-material-design/css-compiled/material.css" rel="stylesheet">
    <link href="../bower_components/bootstrap-material-design/icons/icons-material-design.css" rel="stylesheet">
</head>
<body>
<div class="container-fluid">
    <div class="bs-component">
        <div class="navbar navbar-default">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse"
                        data-target=".navbar-responsive-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="javascript:void(0)">Typeahead</a>
            </div>
            <div class="navbar-collapse collapse navbar-responsive-collapse">
                <form class="navbar-form navbar-left">
                    <input type="text" class="form-control col-lg-8" onkeyup="typeahead(this.value)"
                           placeholder="Search">
                </form>
            </div>
        </div>
    </div>


    <!--<label for="query">Search for </label>-->
    <!--<input id="query" onkeyup="typeahead(this.value)"/>-->
    <div class="bs-docs-section">
        <p>Query took <span id="qTime">0ms</span></p>
        <div class="container-fluid">
            <ol id=results></ol>
        </div>
    </div>
</div>

<script type="text/javascript" src="../bower_components/jquery/dist/jquery.min.js"></script>
<!--<script src="../bower_components/bootstrap-material-design/scripts/ripples.js"></script>-->
<!--<script src="../bower_components/bootstrap-material-design/scripts/material.js"></script>-->
<script type="text/javascript">
    function typeahead(q) {
        $.getJSON('search', {'q': q}, function (data, status, xhr) {
            $('#qTime').text(xhr.getResponseHeader('X-Response-Time') || '0ms');
            $('#results').empty();
            data.searches.forEach(function (search) {
                var searchLi = $(document.createElement('li')),
                        searchOl = $(document.createElement('ol')),
                        results = data.results[search.name] || {},
                        time = results;
                $('#results').append(searchLi);

                if (search.timePath) {
                    search.timePath.forEach(function (p) {
                        time = time[p];
                        if (!time && time !== 0) throw new Error("Can't find time taken");
                    })
                }

                searchLi.text(search.name + ' (' + time + 'ms)');
                searchLi.append(searchOl);

                if (search.resultPath) {
                    search.resultPath.forEach(function (p) {
                        results = results[p];
                        if (!results) throw new Error("Can't find results");
                    });
                }

                results.forEach(function (result) {
                    var resultLi = $(document.createElement('li'));
                    search.displayProps.forEach(function (displayProp) {
                        if (result[displayProp]) resultLi.append(' <span class="' + displayProp + '">' + result[displayProp] + '</span>');
                    });
                    searchOl.append(resultLi);
                });
            });
        });
    }
</script>
</body>
</html>