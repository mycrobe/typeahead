<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Typeahead</title>
</head>
<body>
    <label for="query">Search for </label>
    <input id="query" onkeyup="typeahead(this.value)" />
    <p>Query took <span id="qTime">0ms</span></p>
    <ol id=results></ol>
    <script type="text/javascript" src="../bower_components/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript">
        function typeahead(q) {
            $.getJSON('search', {'q':q}, function(data, status, xhr) {
                $('#qTime').text(xhr.getResponseHeader('X-Response-Time') || '0ms');
                $('#results').empty();
                data.searches.forEach(function(search) {
                    var searchLi = $(document.createElement('li')),
                        searchOl = $(document.createElement('ol')),
                        results = data.results[search.name] || {},
                        time = results;
                    $('#results').append(searchLi);

                    if(search.timePath) {
                        search.timePath.forEach(function(p) {
                            time = time[p];
                            if(!time && time !== 0) throw new Error("Can't find time taken");
                        })
                    }

                    searchLi.text(search.name + ' (' + time + 'ms)');
                    searchLi.append(searchOl);

                    if(search.resultPath) {
                        search.resultPath.forEach(function(p) {
                            results = results[p];
                            if(!results) throw new Error("Can't find results");
                        });
                    }

                    results.forEach(function(result) {
                        var resultLi = $(document.createElement('li'));
                        search.displayProps.forEach(function(displayProp) {
                            if(result[displayProp]) resultLi.append(' <span class="' + displayProp + '">' + result[displayProp] + '</span>');
                        });
                        searchOl.append(resultLi);
                    });
                });
            });
        }
    </script>
</body>
</html>